{% extends 'programmes/base.html' %}

{% load static %}

{% block welcome %}



<div class="row">
  <div class="col-xl-9 mx-auto">
    <h1 class="mb-5">Votre recherche:</h1>
  </div>

  <div class="col-lg-12 col-md-10 col-lg-8 col-xl-7 mx-auto">
    <table class="table table-bordered table-striped table-condensed">
      <thead>
        <tr>
          <th>Nombre de résultat maximum</th>
          <th>{{ info_search.max_resultats }}</th>
        </tr>
        <tr>
          <th>Chaînes</th>
          <th>
              <!-- Trigger/Open The Modal -->
              <button class="btn btn-primary" onclick="btnFunction()">Visualiser les chaînes</button>
              <!-- The Modal -->
              {% if info_search.chaines_string|length < 100 %}
                <div id="myModal" class="modal width-20p text-center height-100" onclick="closeFunction()">
                  {{ info_search.chaines_string }}
                </div>
              {% else %}
                <div id="myModal" class="modal width-20p text-center" onclick="closeFunction()">
                  {{ info_search.chaines_string }}
                </div>
              {% endif %}
          </th>
        </tr>
        {% if info_search.recherche is not None %}
          <tr>
            <th>Recherche</th>
            <th>{{ info_search.recherche }}</th>
          </tr>
        {% endif %}
        {% if info_search is not None %}
          {% if info_search.titre is not None %}
          <tr>
            <th>Titre:</th>
            <th>{{ info_search.titre }}</th>
          </tr>
          {% endif %}
          {% if info_search.titre_informatif is not None %}
          <tr>
            <th>Titre informatif</th>
            <th>{{ info_search.titre_informatif }}</th>
          </tr>
          {% endif %}
          {% if info_search.description is not None %}
          <tr>
            <th>Description:</th>
            <th>{{ info_search.description }}</th>
          </tr>
          {% endif %}
          {% if info_search.realisateur is not None %}
          <tr>
            <th>Realisateur:</th>
            <th>{{ info_search.realisateur }}</th>
          </tr>
          {% endif %}
          {% if info_search.acteur is not None %}
          <tr>
            <th>Acteur:</th>
            <th>{{ info_search.acteur }}</th>
          </tr>
          {% endif %}
          {% if info_search.role is not None %}
          <tr>
            <th>Rôle:</th>
            <th>{{ info_search.role }}</th>
          </tr>
          {% endif %}
          {% if info_search.scenariste is not None %}
          <tr>
            <th>Scenariste:</th>
            <th>{{ info_search.scenariste }}</th>
          </tr>
          {% endif %}
          {% if info_search.date_realisation is not None %}
          <tr>
            <th>Date de réalisation:</th>
            <th>{{ info_search.date_realisation }}</th>
          </tr>
          {% endif %}
          {% if info_search.categories is not None %}
          <tr>
            <th>Categorie:</th>
            <th>{{ info_search.categories }}</th>
          </tr>
          {% endif %}
          {% if info_search.serie is not None %}
          <tr>
            <th>Serie:</th>
            <th>{{ info_search.serie }}</th>
          </tr>
          {% endif %}
          {% if info_search.episode is not None %}
          <tr>
            <th>Episode:</th>
            <th>{{ info_search.episode }}</th>
          </tr>
          {% endif %}
          {% if info_search.partie is not None %}
          <tr>
            <th>Partie:</th>
            <th>{{ info_search.partie }}</th>
          </tr>
          {% endif %}
          {% if info_search.pays_realisation is not None %}
          <tr>
            <th>Pays de réalisation:</th>
            <th>{{ info_search.pays_realisation }}</th>
          </tr>
          {% endif %}
          {% if info_search.public is not None %}
          <tr>
            <th>Public:</th>
            <th>{{ info_search.public }}</th>
          </tr>
          {% endif %}
          {% if info_search.aide_sourd is not None %}
          <tr>
            <th>Sous titres malentendants:</th>
            {% if info_search.aide_sourd %}
              <th>Oui</th>
            {% else %}
              <th>Non</th>
            {% endif %}
          </tr>
          {% endif %}
          {% if info_search.note is not None %}
          <tr>
            <th>Note:</th>
            <th>{{ info_search.note }}</th>
          </tr>
          {% endif %}
          {% if info_search.critique is not None %}
          <tr>
            <th>Critique:</th>
            <th>{{ info_search.critique }}</th>
          </tr>
          {% endif %}
        {% endif %}
      </thead>
    </table>
  </div>

  <div class="col-xl-9 mx-auto my-5">
    <h1 class="mb-5">Les résultats de votre recherche:</h1>
  </div>

  <div class="col-md-10 col-lg-8 col-xl-7 mx-auto">
    <form>
      <div class="form-row">
        <div class="col-12 col-md-9 mb-2 mb-md-0">
          {% if info_programmes|length > 0 %}
            {% for prog in info_programmes %}
              <p>##################################</p>
              <p>Chaine: {{ prog.chaine }}</p>
              <p>Date début: {{ prog.programme.date_debut }}</p>
              <p>Date fin: {{ prog.programme.date_fin }}</p>
              {% if prog.titres|length > 0 %}
                <p>Titres:</p>
                {% for titre in prog.titres %}
                  <p><span nom="titre">{{ titre.nom }}</span></p>
                {% endfor %}
              {% endif %}
              {% if prog.programme.titre_informatif %}
                <p>-------------------------------------------</p>
                <p>Titre informatif:</p>
                <p><span nom="titre_informatif">{{ prog.programme.titre_informatif}}</span></p>
              {% endif %}
              {% if prog.programme.description %}
                <p>-------------------------------------------</p>
                <p>Description:</p>
                <p><span nom="description">{{ prog.programme.description}}</span></p>
              {% endif %}
              {% if prog.realisateur|length > 0 %}
                <p>-------------------------------------------</p>
                <p>Réalisateurs:</p>
                {% for realisateur in prog.realisateur %}
                  <p><span nom="realisateur">{{ realisateur.nom }}</span></p>
                {% endfor %}
              {% endif %}
              {% if prog.acteurs|length > 0 %}
                <p>-------------------------------------------</p>
              {% for acteur in prog.acteurs %}
                {% if acteur.role %}
                  <p><span nom="acteur_role">Acteur: {{ acteur.nom }}---Rôle: {{ acteur.role }}</span></p>
                {% else %}
                <p><span nom="acteur">Acteur: {{ acteur.nom }}</span></p>
                {% endif %}
              {% endfor %}
              {% endif %}
              {% if prog.scenariste|length > 0 %}
                <p>-------------------------------------------</p>
                <p>Scenaristes:</p>
                {% for scenariste in prog.scenariste %}
                  <p><span nom="scenariste">{{ scenariste.nom }}</span></p>
                {% endfor %}
              {% endif %}
              {% if prog.programme.date_realisation %}
                <p>-------------------------------------------</p>
                <p>Année de réalisation: {{ prog.programme.date_realisation }}</p>
              {% endif %}
              {% if prog.categories|length > 0 %}
                <p>-------------------------------------------</p>
                <p>Categories:</p>
                {% for categorie in prog.categories %}
                  <p><span nom="categorie">{{ categorie.nom }}</span></p>
                {% endfor %}
              {% endif %}
              {% if prog.series|length > 0 %}
                <p>-------------------------------------------</p>
                <p>Serie: {{ prog.series.0.serie }}</p>
                <p>Episode: {{ prog.series.0.episode }}</p>
                <p>Partie: {{ prog.series.0.partie }}</p>
              {% endif %}
              {% if prog.pays|length > 0 %}
                <p>-------------------------------------------</p>
                <p>Pays de réalisation:</p>
                {% for pays in prog.pays %}
                  <p><span nom="pays">{{ pays.nom }}</span></p>
                {% endfor %}
              {% endif %}
              {% if prog.programme.public %}
                <p>-------------------------------------------</p>
                <p>Public: {{ prog.programme.public}} ans</p>
              {% endif %}
              {% if prog.programme.aide_sourd %}
                <p>-------------------------------------------</p>
                <p>Sous-titres malentendants: Oui</p>
              {% endif %}
              {% if prog.programme.note %}
                <p>-------------------------------------------</p>
                <p>Note: {{ prog.programme.note}}/5</p>
              {% endif %}
              {% if prog.programme.critique %}
                <p>-------------------------------------------</p>
                <p>Critique:</p>
                <p><span nom="critique">{{ prog.programme.critique}}</span></p>
              {% endif %}
            {% endfor %}
          {% else %}
            <p>La recherche n'a donnée aucun résultat pour les 7 prochains jours</p>
          {% endif %}
        </div>
        <div class="col-lg-8 col-md-8 my-4">
          <a class="btn btn-block btn-lg btn-primary" href="{% url 'welcome' %}">Effectuer une nouvelle recherche</a>
        </div>
      </div>
    </form>
  </div>
</div>


<script type="text/javascript">
  let spans = document.getElementsByTagName('span');
  console.log(spans)

  for(let i = 0; i < spans.length; i++)
  {
      let s = spans[i].innerHTML;
      console.log(spans[i])
      console.log(s)
      let rech = "{{ info_search.recherche }}"
      if (rech.length > 0) {
        const barerech = rech.normalize("NFD").replace(/[\u0300-\u036f]/g, "")
        console.log(barerech)
        const regrech =  new RegExp(barerech,'gi');
        console.log(regrech)
        s = s.replace(regrech, '<span class="search" style="color:green"></span>');
      }
      if (spans[i].getAttribute('nom') == 'titre') {
        let titre = "{{ info_search.titre }}"
        console.log(titre)
        const bare_titre = titre.normalize("NFD").replace(/[\u0300-\u036f]/g, "")
        console.log(bare_titre)
        const reg_titre =  new RegExp(bare_titre,'gi');
        console.log(reg_titre)
        s = s.replace(reg_titre, '<span class="titre" style="color:red"></span>');
        }
        console.log(s)
      if (spans[i].getAttribute('nom') == 'titre_informatif') {
        let titre_inf = "{{ info_search.titre_informatif }}"
        let bare_titre_inf = titre_inf.normalize("NFD").replace(/[\u0300-\u036f]/g, "")
        const reg_titre_inf =  new RegExp(bare_titre_inf,'gi');
        s = s.replace(reg_titre_inf, '<span class="titre_informatif" style="color:red"></span>');
        }
      if (spans[i].getAttribute('nom') == 'description') {
        let desc = "{{ info_search.description }}"
        let bare_desc = desc.normalize("NFD").replace(/[\u0300-\u036f]/g, "")
        const reg_desc =  new RegExp(bare_desc,'gi');
        s = s.replace(reg_desc, '<span class="description" style="color:red"></span>');
        }
      if (spans[i].getAttribute('nom') == 'realisateur') {
        let real = "{{ info_search.realisateur }}"
        let bare_real = real.normalize("NFD").replace(/[\u0300-\u036f]/g, "")
        const reg_real =  new RegExp(bare_real,'gi');
        s = s.replace(reg_real, '<span class="realisateur" style="color:red"></span>');
        }
      if (spans[i].getAttribute('nom') == 'acteur_role') {
        let actor = "{{ info_search.acteur }}"
        let bare_actor = actor.normalize("NFD").replace(/[\u0300-\u036f]/g, "")
        const reg_actor =  new RegExp(bare_actor,'gi');
        s = s.replace(reg_actor, '<span class="acteur" style="color:red"></span>');
        let role = "{{ info_search.role }}"
        let bare_role = role.normalize("NFD").replace(/[\u0300-\u036f]/g, "")
        const reg_role =  new RegExp(bare_role,'gi');
        s = s.replace(reg_role, '<span class="role" style="color:red"></span>');
        }
      if (spans[i].getAttribute('nom') == 'acteur') {
        let actor = "{{ info_search.acteur }}"
        let bare_actor = actor.normalize("NFD").replace(/[\u0300-\u036f]/g, "")
        const reg_actor =  new RegExp(bare_actor,'gi');
        s = s.replace(reg_actor, '<span class="acteur" style="color:red"></span>');
      }
      if (spans[i].getAttribute('nom') == 'scenariste') {
        let scena = "{{ info_search.scenariste }}"
        let bare_scena = scena.normalize("NFD").replace(/[\u0300-\u036f]/g, "")
        const reg_scena =  new RegExp(bare_scena,'gi');
        s = s.replace(reg_scena, '<span class="scenariste" style="color:red"></span>');  
        }
      if (spans[i].getAttribute('nom') == 'categorie') {
        let categ = "{{ info_search.categories }}"
        let bare_categ = categ.normalize("NFD").replace(/[\u0300-\u036f]/g, "")
        const reg_categ =  new RegExp(bare_categ,'gi');
        s = s.replace(reg_categ, '<span class="categorie" style="color:red"></span>');
        }
      if (spans[i].getAttribute('nom') == 'pays') {
        let pays = "{{ info_search.pays_realisation }}"
        let bare_pays = pays.normalize("NFD").replace(/[\u0300-\u036f]/g, "")
        const reg_pays =  new RegExp(bare_pays,'gi');
        s = s.replace(reg_pays, '<span class="pays" style="color:red"></span>');  
        }
      if (spans[i].getAttribute('nom') == 'critique') {
        let criti = "{{ info_search.critique }}"
        let bare_criti = criti.normalize("NFD").replace(/[\u0300-\u036f]/g, "")
        const reg_criti =  new RegExp(bare_criti,'gi');
        s = s.replace(reg_criti, '<span class="critique" style="color:red"></span>');  
        }
      console.log(s)
      spans[i].innerHTML = s;
  }

  let search = document.getElementsByClassName('search');

  for(let i = 0; i < search.length; i++)
  {
      search[i].innerHTML = '{{ info_search.recherche }}'
  }

  let titre = document.getElementsByClassName('titre');

  for(let i = 0; i < titre.length; i++)
  {
      titre[i].innerHTML = '{{ info_search.titre }}'
  }

  let titre_informatif = document.getElementsByClassName('titre_informatif');

  for(let i = 0; i < titre_informatif.length; i++)
  {
      titre_informatif[i].innerHTML = '{{ info_search.titre_informatif }}'
  }

  let description = document.getElementsByClassName('description');

  for(let i = 0; i < description.length; i++)
  {
      description[i].innerHTML = '{{ info_search.description }}'
  }

  let realisateur = document.getElementsByClassName('realisateur');

  for(let i = 0; i < realisateur.length; i++)
  {
      realisateur[i].innerHTML = '{{ info_search.realisateur }}'
  }

  let acteur = document.getElementsByClassName('acteur');

  for(let i = 0; i < acteur.length; i++)
  {
      acteur[i].innerHTML = '{{ info_search.acteur }}'
  }

  let role = document.getElementsByClassName('role');

  for(let i = 0; i < role.length; i++)
  {
      role[i].innerHTML = '{{ info_search.role }}'
  }

  let scenariste = document.getElementsByClassName('scenariste');

  for(let i = 0; i < scenariste.length; i++)
  {
      scenariste[i].innerHTML = '{{ info_search.scenariste }}'
  }

  let categorie = document.getElementsByClassName('categorie');

  for(let i = 0; i < categorie.length; i++)
  {
      categorie[i].innerHTML = '{{ info_search.categorie }}'
  }

  let pays = document.getElementsByClassName('pays');

  for(let i = 0; i < pays.length; i++)
  {
      pays[i].innerHTML = '{{ info_search.pays_realisation }}'
  }

  let critique = document.getElementsByClassName('critique');

  for(let i = 0; i < critique.length; i++)
  {
      critique[i].innerHTML = '{{ info_search.critique }}'
  }

  function btnFunction() {
    let modal = document.getElementById('myModal')
    modal.style.display = "block";
  }

  function closeFunction() {
    let modal = document.getElementById('myModal')
    modal.style.display = "none";
  }

</script>


{% endblock %}